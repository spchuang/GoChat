!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(1),c=r(l),f=n(5),p=(r(f),n(10)),h=r(p),d=n(3),v=r(d),m=n(12),g=r(m),y=n(2),_=(r(y),n(8)),b=r(_),w=function(e){function t(e){o(this,t);var n=s(this,Object.getPrototypeOf(t).call(this,e));return n._messageContainer=null,n._handleChange=function(e){n.setState({val:e.target.value})},n._handleSend=function(){n.setState({loading:!0}),n._store.sendMessage(n.state.val,function(){n.setState({val:"",loading:!1})},function(){n.setState({loading:!1})})},n._handleMessageContainerScroll=function(e){(0,h["default"])(window).scrollTop()<50&&n.state.hasMore&&n._store.getPreviousMessages()},n._store=new g["default"](e),n.state=a({val:"",loading:!1},n._store.getState()),n}return i(t,e),u(t,[{key:"componentDidMount",value:function(){var e=this;this._scrollToBottom(),this._store.startPolling(),this._store.addChangeListener(function(){var t=e._store.getState();e.setState(t)}),this._scrollHeight=(0,h["default"])(document.body).prop("scrollHeight"),this._scrollTop=(0,h["default"])(window).scrollTop(),window.addEventListener("scroll",this._handleMessageContainerScroll)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this._handleMessageContainerScroll)}},{key:"componentWillUpdate",value:function(){this._scrollHeight=(0,h["default"])(document.body).prop("scrollHeight"),this._scrollTop=(0,h["default"])(window).scrollTop()}},{key:"componentDidUpdate",value:function(e,t){t.messages&&this.state.messages&&this.state.messages[this.state.messages.length-1].id>t.messages[t.messages.length-1].id?this._scrollToBottom():null!==this._scrollTop&&this._scrollHeight&&(0,h["default"])(window).scrollTop(this._scrollTop+((0,h["default"])(document.body).prop("scrollHeight")-this._scrollHeight))}},{key:"render",value:function(){return c["default"].createElement("div",{className:"message-chat-view"},this._renderMessages(),this._renderFooter())}},{key:"_renderMessages",value:function(){var e=this,t=this.state.messages.map(function(t){return c["default"].createElement("div",null,c["default"].createElement("span",{className:(0,v["default"])("message","message-bubble",{me:t.receiverID===e.props.receiverID})},t.content),c["default"].createElement("div",{className:"clear"}))}),n=this.state.hasMore?c["default"].createElement("div",null,c["default"].createElement("div",{className:"spinner"})):null;return c["default"].createElement("div",{className:"message-content",ref:function(t){e._messageContainer=t}},n,t)}},{key:"_renderFooter",value:function(){return c["default"].createElement("div",{className:"message-chat-footer"},c["default"].createElement("div",{className:"input-group"},c["default"].createElement("input",{type:"text",value:this.state.val,className:"form-control input-lg",placeholder:this.props.text.messageInputPlaceholder,onChange:this._handleChange,disabled:this.state.loading,autoFocus:!0}),c["default"].createElement("span",{className:"input-group-btn"},c["default"].createElement("button",{className:"btn btn-primary btn-lg",onClick:this._handleSend,disabled:!this.state.val||this.state.loading},c["default"].createElement("span",{className:"glyphicon glyphicon-send"})))))}},{key:"_scrollToBottom",value:function(){(0,h["default"])(window).scrollTop((0,h["default"])(window).height())}}]),t}(c["default"].Component);b["default"].setup(w)},function(e,t){e.exports=React},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),l=r(u),c=function(e){function t(){return o(this,t),s(this,Object.getPrototypeOf(t).apply(this,arguments))}return i(t,e),a(t,[{key:"render",value:function(){return l["default"].createElement("div",{className:"spinnerOverlay"},l["default"].createElement("div",{className:"spinner"}))}}]),t}(l["default"].PureComponent);e.exports=c},function(e,t,n){var r,o;/*!
	  Copyright (c) 2016 Jed Watson.
	  Licensed under the MIT License (MIT), see
	  http://jedwatson.github.io/classnames
	*/
!function(){"use strict";function n(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];if(r){var o=typeof r;if("string"===o||"number"===o)e.push(r);else if(Array.isArray(r))e.push(n.apply(null,r));else if("object"===o)for(var i in r)s.call(r,i)&&r[i]&&e.push(i)}}return e.join(" ")}var s={}.hasOwnProperty;"undefined"!=typeof e&&e.exports?e.exports=n:(r=[],o=function(){return n}.apply(t,r),!(void 0!==o&&(e.exports=o)))}()},function(e,t){e.exports=MessengerExtensions},function(e,t){e.exports=ReactDOM},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),l=r(u),c=n(7),f=r(c),p=function(e){function t(){return o(this,t),s(this,Object.getPrototypeOf(t).apply(this,arguments))}return i(t,e),a(t,[{key:"render",value:function(){return l["default"].createElement(f["default"],null,l["default"].createElement("div",{className:"col-xs-12 col-sm-10 col-sm-offset-1 col-md-6 col-md-offset-3"},l["default"].createElement("button",{type:"button",className:"btn btn-primary btn-lg btn-block",disabled:this.props.disabled,onClick:this.props.onClick},this.props.text)))}}]),t}(l["default"].PureComponent);e.exports=p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),l=r(u),c=function(e){function t(){return o(this,t),s(this,Object.getPrototypeOf(t).apply(this,arguments))}return i(t,e),a(t,[{key:"render",value:function(){return l["default"].createElement("div",{className:"footer"},l["default"].createElement("div",{className:"container"},l["default"].createElement("div",{className:"row"},this.props.children)))}}]),t}(l["default"].PureComponent);e.exports=c},function(e,t,n){(function(t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(10),f=r(c),p=n(1),h=r(p),d=n(5),v=r(d),m=n(3),g=(r(m),n(2)),y=r(g),_=n(6),b=r(_),w=n(9),E=r(w),O=function(e){function t(e){s(this,t);var n=i(this,Object.getPrototypeOf(t).call(this,e));n._submit=function(){n._fetchProps({u:n.state.token},function(){E["default"].storeUserToken(n.state.token)})};var r=e.userID,a=o(e,["userID"]);return n.state={userID:r,componentProps:a,error:null,showTokenInput:!1,loading:!1,token:""},n}return a(t,e),l(t,[{key:"getIsInitialize",value:function(){return!!this.state.userID}},{key:"componentDidMount",value:function(){var e=this;this.getIsInitialize()||E["default"].isInExtention(function(t){if(!t){var n=E["default"].getUserToken();return void(n?e._fetchProps({u:n},function(){},function(){e.setState({showTokenInput:!0})}):e.setState({showTokenInput:!0}))}E["default"].getUserID(function(t){e._fetchProps({fbid:t})})})}},{key:"render",value:function(){if(!this.getIsInitialize())return this._renderUninitializedView();var e=this.props.Component;return h["default"].createElement(e,u({userID:this.state.userID},this.state.componentProps))}},{key:"_renderUninitializedView",value:function(){var e=this.state.showTokenInput?h["default"].createElement("div",null,this._renderErrorAlert(),h["default"].createElement("h5",null,h["default"].createElement("label",null,this.props.text.notSupportedText)),this._renderTokenInput()):h["default"].createElement(y["default"],null),t=this.state.showTokenInput?this._renderFooter():null;return h["default"].createElement("div",null,this.state.loading?h["default"].createElement(y["default"],null):null,h["default"].createElement("div",{className:"container"},h["default"].createElement("div",{className:"row"},h["default"].createElement("div",{className:"col-xs-12 col-sm-10 col-sm-offset-1 col-md-6 col-md-offset-3"},e))),t)}},{key:"_renderErrorAlert",value:function(){return this.state.error?h["default"].createElement("div",{className:"alertHeader alert alert-danger",role:"alert"},this.state.error):null}},{key:"_renderTokenInput",value:function(){var e=this;return h["default"].createElement("div",{className:"form-group"},h["default"].createElement("input",{className:"form-control","class":"form-control",placeholder:"<token>",value:this.state.token,onChange:function(t){return e.setState({token:t.target.value})}}))}},{key:"_renderFooter",value:function(){return h["default"].createElement(b["default"],{text:this.props.text.enterButton,onClick:this._submit})}},{key:"_fetchProps",value:function(e,t,n){var r=this;f["default"].get(this.props.jsonURL,e).done(function(e){var n=e.userID,s=o(e,["userID"]);r.setState({userID:n,componentProps:s}),t&&t()}).fail(function(e){r.setState({error:e.responseText}),n&&n()})}}]),t}(h["default"].Component);e.exports={setup:function(e){t.setup=function(t,n,r){v["default"].render(h["default"].createElement(O,u({},n,{Component:e,jsonURL:r})),document.getElementById(t))}}}}).call(t,function(){return this}())},function(e,t,n){"use strict";function r(e){return console.log(f),f?void e(f):void setTimeout(r,150,e)}function o(e){r(function(t){e(t.isInExtension())})}function s(e){r(function(t){t.getSupportedFeatures(function(e){console.log(e)},function(e){console.log(e)}),t.getUserID(function(t){e(t.psid)},function(n,r){t.getContext("1833481820212349",function(t){console.log(t.psid),e(t.psid)},function(e){console.log(e)})})})}function i(){var e=n(4),t=e.isInExtension();t?e.requestCloseBrowser(function(){},function(e){}):window.close()}function a(e){l("u",e,28)}function u(){return c("u")}function l(e,t,n){var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3);var o="expires="+r.toUTCString();document.cookie=e+"="+t+";"+o+";path=/"}function c(e){for(var t=e+"=",n=decodeURIComponent(document.cookie),r=n.split(";"),o=0;o<r.length;o++){for(var s=r[o];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return""}var f=null;window.extAsyncInit=function(){f=n(4)},e.exports={closeWebView:i,getUserID:s,isInExtention:o,storeUserToken:a,getUserToken:u}},function(e,t){e.exports=jQuery},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(13),l=r(u),c="change",f=function(e){function t(){return o(this,t),s(this,Object.getPrototypeOf(t).apply(this,arguments))}return i(t,e),a(t,[{key:"emitChange",value:function(){this.emit(c)}},{key:"addChangeListener",value:function(e){this.on(c,e)}},{key:"removeChangeListener",value:function(e){this.removeListener(c,e)}}]),t}(l["default"].EventEmitter);e.exports=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){var n={};return e.reduce(function(e,r){var o=r[t];return n[o]?e:(n[o]=!0,e.concat(r))},[])}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(10),c=r(l),f=n(11),p=r(f),h=2e3,d="/message",v=function(e){function t(e){o(this,t);var n=s(this,Object.getPrototypeOf(t).call(this));return n._messages=[],n._addMessages(e.messages),n._receiverID=e.receiverID,n._userID=e.userID,n._hasMore=e.hasMore,n._loadingPreviousMessage=!1,n}return i(t,e),u(t,[{key:"startPolling",value:function(){var e=this,t={u:this._userID,receiverID:this._receiverID};this._messages.length>0&&(t.afterMessageID=this._messages[this._messages.length-1].id),c["default"].get(d+"/getAfter",t).done(function(t){t.messages&&t.messages.length>0&&e._addMessagesAndEmitChange(t.messages),setTimeout(e.startPolling.bind(e),h)}).fail(function(t){console.log(t),setTimeout(e.startPolling.bind(e),h)})}},{key:"getState",value:function(){return{messages:this._messages.slice(0),hasMore:this._hasMore}}},{key:"getPreviousMessages",value:function(){var e=this;if(!this._loadingPreviousMessage){this._loadingPreviousMessage=!0;var t={u:this._userID,receiverID:this._receiverID};this._messages.length>0&&(t.beforeMessageID=this._messages[0].id),c["default"].get(d+"/getBefore",t).done(function(t){t.messages&&t.messages.length>0&&(e._hasMore=t.hasMore,e._addMessagesAndEmitChange(t.messages)),e._loadingPreviousMessage=!1}).fail(function(t){e._loadingPreviousMessage=!1})}}},{key:"sendMessage",value:function(e,t,n){var r=this;c["default"].post(d+"/send",{content:e,u:this._userID,receiverID:this._receiverID}).done(function(e){e.message&&r._addMessagesAndEmitChange([e.message]),t()}).fail(function(e){n()})}},{key:"_addMessagesAndEmitChange",value:function(e){this._addMessages(e),this.emitChange()}},{key:"_addMessages",value:function(e){this._messages=a(this._messages.concat(e),"id"),this._messages.sort(function(e,t){return e.id-t.id})}}]),t}(p["default"]);e.exports=v},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function o(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function i(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!o(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,o,a,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],i(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(s(n))for(a=Array.prototype.slice.call(arguments,1),l=n.slice(),o=l.length,u=0;o>u;u++)l[u].apply(this,a);return!0},n.prototype.addListener=function(e,t){var o;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(o=i(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),o||(o=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var o=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,o,i,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,o=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=i;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){o=a;break}if(0>o)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}}]);
//# sourceMappingURL=MessageContainer.prod.js.map