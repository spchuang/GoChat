{"version":3,"file":"../web/js/dist/web/MessageContainer.dev.js","sources":["webpack:///webpack/bootstrap 3137c1602d78b2f9b130","webpack:///public/src/js/web/MessageContainer.jsx","webpack:///external \"React\"","webpack:///external \"ReactDOM\"","webpack:///external \"jQuery\"","webpack:///./~/classNames/index.js","webpack:///public/src/js/web/MessageStore.js","webpack:///public/src/js/common/EventStore.js","webpack:///./~/events/events.js","webpack:///public/src/js/common/OverlaySpinner.jsx","webpack:///public/src/js/common/UserLoaderContainer.jsx","webpack:///public/src/js/common/Footer.jsx","webpack:///public/src/js/common/FooterWrapper.jsx","webpack:///public/src/js/common/WebViewUtils.js","webpack:///external \"MessengerExtensions\""],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 3137c1602d78b2f9b130\n **/","/*\n * @flow\n */\n\n'use strict';\n\nimport React, {PropTypes} from 'react';\nimport ReactDOM from 'react-dom';\nimport $ from 'jquery';\nimport classNames from 'classNames';\nimport MessageStore from './MessageStore';\nimport OverlaySpinner from '../common/OverlaySpinner.jsx';\nimport UserLoaderContainer from '../common/UserLoaderContainer.jsx';\n\ntype State = {\n  val: string,\n  messages: Array<Object>,\n  hasMore: boolean,\n  loading: boolean,\n};\n\ntype Props = {\n  messages: Array<Object>,\n  hasMore: boolean,\n  userID: string,\n  receiverID: number,\n  text: {\n    messageInputPlaceholder: string,\n  },\n};\n\nclass MessageContainer extends React.Component {\n  state: State;\n  props: Props;\n  _store;\n  _messageContainer: ?HTMLDivElement = null;\n  _scrollTop: number;\n  _scrollHeight: number;\n\n  constructor(props: Object) {\n    super(props);\n    this._store = new MessageStore(props);\n    this.state = {\n      val: '',\n      loading: false,\n      ...this._store.getState(),\n    };\n  }\n\n  componentDidMount(): void {\n    this._scrollToBottom();\n    this._store.startPolling();\n    this._store.addChangeListener(() => {\n      const state = this._store.getState();\n      this.setState(state);\n    });\n\n    this._scrollHeight = $(document.body).prop('scrollHeight');\n    this._scrollTop = $(window).scrollTop();\n    window.addEventListener('scroll', this._handleMessageContainerScroll);\n  }\n\n  componentWillUnmount() {;\n    window.removeEventListener('scroll', this._handleMessageContainerScroll);\n  }\n\n  componentWillUpdate(): void {\n    this._scrollHeight = $(document.body).prop('scrollHeight');\n    this._scrollTop = $(window).scrollTop();\n  }\n\n  componentDidUpdate(prevProps: Props, prevState: State): void {\n    if (\n      prevState.messages &&\n      this.state.messages &&\n      this.state.messages[this.state.messages.length - 1].id >\n        prevState.messages[prevState.messages.length - 1].id\n    ) {\n      this._scrollToBottom();\n    } else {\n      // restore original scroll position\n      if (\n        this._scrollTop !== null && // handle 0 case\n        this._scrollHeight\n      ) {\n        $(window).scrollTop(\n          this._scrollTop + ($(document.body).prop('scrollHeight') - this._scrollHeight)\n        );\n      }\n    }\n  }\n\n  render(): React.Element<*> {\n    return (\n      <div className=\"message-chat-view\">\n        {this._renderMessages()}\n        {this._renderFooter()}\n      </div>\n    );\n  }\n\n  _renderMessages(): React.Element<*> {\n    const messages = this.state.messages.map((m: Object) => {\n      return (\n        <div>\n          <span className={classNames(\n          'message', 'message-bubble', {\n            'me': m.receiverID === this.props.receiverID,\n          })}>\n            {m.content}\n          </span>\n          <div className=\"clear\"/>\n        </div>\n      )\n    });\n\n    const spinner = this.state.hasMore\n      ? <div><div className=\"spinner\"></div></div>\n      : null;\n\n    return (\n      <div\n        className=\"message-content\"\n        ref={(el) => { this._messageContainer = el; }}>\n        {spinner}\n        {messages}\n      </div>\n    );\n  }\n\n  _renderFooter(): React.Element<*> {\n    return (\n      <div className=\"message-chat-footer\">\n        <div className=\"input-group\">\n          <input\n            type=\"text\"\n            value={this.state.val}\n            className=\"form-control input-lg\"\n            placeholder={this.props.text.messageInputPlaceholder}\n            onChange={this._handleChange}\n            disabled={this.state.loading}\n            autoFocus={true}\n          />\n          <span className=\"input-group-btn\">\n            <button\n              className=\"btn btn-primary btn-lg\"\n              onClick={this._handleSend}\n              disabled={!this.state.val || this.state.loading}>\n              <span className=\"glyphicon glyphicon-send\"/>\n            </button>\n          </span>\n        </div>\n  \t\t</div>\n    );\n  }\n\n  _handleChange = (evt): void => {\n    this.setState({\n      val: evt.target.value,\n    });\n  };\n\n  _handleSend = (): void => {\n    this.setState({loading: true});\n    this._store.sendMessage(\n      this.state.val,\n      () => {this.setState({val: '', loading: false})},\n      () => {this.setState({loading: false})},\n    );\n  };\n\n  _handleMessageContainerScroll = (evt: Object): void => {\n    if (\n      $(window).scrollTop() < 50 &&\n      this.state.hasMore\n    ) {\n      this._store.getPreviousMessages();\n    }\n  };\n\n  _scrollToBottom(): void {\n    $(window).scrollTop($(window).height());\n  }\n}\n\nUserLoaderContainer.setup(MessageContainer);\n\n\n\n/** WEBPACK FOOTER **\n ** public/src/js/web/MessageContainer.jsx\n **/","module.exports = React;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"React\"\n ** module id = 1\n ** module chunks = 0\n **/","module.exports = ReactDOM;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"ReactDOM\"\n ** module id = 2\n ** module chunks = 0\n **/","module.exports = jQuery;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"jQuery\"\n ** module id = 3\n ** module chunks = 0\n **/","/*!\n  Copyright (c) 2016 Jed Watson.\n  Licensed under the MIT License (MIT), see\n  http://jedwatson.github.io/classnames\n*/\n/* global define */\n\n(function () {\n\t'use strict';\n\n\tvar hasOwn = {}.hasOwnProperty;\n\n\tfunction classNames () {\n\t\tvar classes = [];\n\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tvar arg = arguments[i];\n\t\t\tif (!arg) continue;\n\n\t\t\tvar argType = typeof arg;\n\n\t\t\tif (argType === 'string' || argType === 'number') {\n\t\t\t\tclasses.push(arg);\n\t\t\t} else if (Array.isArray(arg)) {\n\t\t\t\tclasses.push(classNames.apply(null, arg));\n\t\t\t} else if (argType === 'object') {\n\t\t\t\tfor (var key in arg) {\n\t\t\t\t\tif (hasOwn.call(arg, key) && arg[key]) {\n\t\t\t\t\t\tclasses.push(key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn classes.join(' ');\n\t}\n\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tmodule.exports = classNames;\n\t} else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\n\t\t// register as 'classnames', consistent with npm package name\n\t\tdefine('classnames', [], function () {\n\t\t\treturn classNames;\n\t\t});\n\t} else {\n\t\twindow.classNames = classNames;\n\t}\n}());\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/classNames/index.js\n ** module id = 4\n ** module chunks = 0\n **/","/*\n * @flow\n */\n\nimport $ from 'jquery';\nimport EventStore from '../common/EventStore.js'\n\nconst POLLING_INTERVAL = 2000;\nconst BASE_URL = '/message';\n\nclass MessageStore extends EventStore {\n  _messages: Array<Object>;\n  _hasMore: boolean;\n  _receiverID: number;\n  _userID: string;\n  _loadingPreviousMessage: boolean;\n\n  constructor(params: {\n    messages: Array<Object>,\n    hasMore: boolean,\n    userID: string,\n    receiverID: number,\n  }) {\n    super();\n    this._messages = [];\n\n    this._addMessages(params.messages);\n    this._receiverID = params.receiverID;\n    this._userID = params.userID;\n    this._hasMore = params.hasMore;\n    this._loadingPreviousMessage = false;\n  }\n\n  startPolling(): void {\n    const query: Object = {\n      u: this._userID,\n      receiverID: this._receiverID,\n    };\n    if (this._messages.length > 0) {\n      query.afterMessageID = this._messages[this._messages.length - 1].id;\n    }\n\n    // get all the local messages\n    $.get(BASE_URL + '/getAfter', query)\n      .done((res: Object) => {\n        if (res.messages && res.messages.length > 0) {\n          this._addMessagesAndEmitChange(res.messages);\n        }\n        setTimeout(this.startPolling.bind(this), POLLING_INTERVAL)\n      })\n      .fail((res: Object) => {\n        console.log(res);\n        setTimeout(this.startPolling.bind(this), POLLING_INTERVAL)\n      });\n  }\n\n  getState(): {messages: Array<Object>, hasMore: boolean} {\n    // clone the messages for react\n    return {\n      messages: this._messages.slice(0),\n      hasMore: this._hasMore,\n    };\n  }\n\n  getPreviousMessages(): void {\n    if (this._loadingPreviousMessage) {\n      return;\n    }\n\n    this._loadingPreviousMessage = true;\n    const query: Object = {\n      u: this._userID,\n      receiverID: this._receiverID,\n    };\n    if (this._messages.length > 0) {\n      query.beforeMessageID = this._messages[0].id;\n    }\n\n    // get all the local messages\n    $.get(BASE_URL + '/getBefore', query)\n      .done((res: Object) => {\n        if (res.messages && res.messages.length > 0) {\n          this._hasMore = res.hasMore;\n          this._addMessagesAndEmitChange(res.messages);\n        }\n        this._loadingPreviousMessage = false;\n      })\n      .fail((res: Object) => {\n        this._loadingPreviousMessage = false;\n      });\n  }\n\n  sendMessage(content: string, success: () => void, fail: () => void): void {\n    // TODO: optimistic update?\n    $.post(BASE_URL + '/send', {\n      content,\n      u: this._userID,\n      receiverID: this._receiverID,\n    })\n      .done((res: Object) => {\n        if (res.message) {\n          this._addMessagesAndEmitChange([res.message]);\n        }\n        success();\n      })\n      .fail((res: Object) => {\n        fail();\n      });\n  }\n\n  _addMessagesAndEmitChange(messages: Array<Object>): void {\n    this._addMessages(messages);\n    this.emitChange();\n  }\n\n  _addMessages(messages: Array<Object>): void {\n    // concat and remove duplicates\n    this._messages = dedupeByKey(this._messages.concat(messages), 'id');\n    this._messages.sort((a: Object, b: Object): number => {\n      return a.id - b.id;\n    });\n  }\n}\n\nfunction dedupeByKey(arr, key) {\n  const tmp = {};\n  return arr.reduce((p, c) => {\n    const k = c[key];\n    if (tmp[k]) return p;\n    tmp[k] = true;\n    return p.concat(c);\n  }, []);\n}\n\nmodule.exports = MessageStore;\n\n\n\n/** WEBPACK FOOTER **\n ** public/src/js/web/MessageStore.js\n **/","/*\n * @flow\n */\n\nimport events from 'events';\n\nconst CHANGE_EVENT = 'change';\n\nclass EventStore extends events.EventEmitter {\n  emitChange(): void {\n    this.emit(CHANGE_EVENT);\n  }\n\n  addChangeListener(callback: Function): void {\n    this.on(CHANGE_EVENT, callback);\n  }\n\n  removeChangeListener(callback: Function): void {\n    this.removeListener(CHANGE_EVENT, callback);\n  }\n}\n\nmodule.exports = EventStore;\n\n\n\n/** WEBPACK FOOTER **\n ** public/src/js/common/EventStore.js\n **/","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      }\n      throw TypeError('Uncaught, unspecified \"error\" event.');\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/events/events.js\n ** module id = 7\n ** module chunks = 0\n **/","/*\n * @flow\n */\n\n'use strict';\n\nimport React, {PropTypes} from 'react';\n\nclass OverlaySpinner extends React.PureComponent {\n  render(): React.Element<*> {\n    return (\n      <div className=\"spinnerOverlay\">\n        <div className=\"spinner\"></div>\n      </div>\n    );\n  }\n}\n\nmodule.exports = OverlaySpinner;\n\n\n\n/** WEBPACK FOOTER **\n ** public/src/js/common/OverlaySpinner.jsx\n **/","/*\n * @flow\n */\n\n'use strict';\n\nimport $ from 'jquery';\nimport React, {PropTypes} from 'react';\nimport ReactDOM from 'react-dom';\nimport classNames from 'classNames';\nimport OverlaySpinner from '../common/OverlaySpinner.jsx';\nimport Footer from '../common/Footer.jsx';\nimport WebViewUtils from './WebViewUtils.js';\n\ntype Props = {\n  userID?: string,\n  text: Object,\n  Component: Object,\n  jsonURL: string,\n};\n\ntype State = {\n  userID: ?string,\n  componentProps: ?Object,\n  error: ?string,\n  showTokenInput: boolean,\n  loading: boolean,\n  token: string,\n};\n\nclass UserLoaderContainer extends React.Component {\n  props: Props;\n  state: State;\n\n  constructor(props: Object) {\n    super(props);\n    const {userID, ...restProps} = props;\n    this.state = {\n      userID,\n      componentProps: restProps,\n      error: null,\n      showTokenInput: false,\n      loading: false,\n      token: '',\n    };\n  }\n\n  getIsInitialize(): boolean{\n    return !!this.state.userID;\n  }\n\n  componentDidMount(): void {\n    if (this.getIsInitialize()) {\n      return;\n    }\n\n    WebViewUtils.isInExtention((isInExtention: bool) => {\n      if (!isInExtention) {\n        // try to fetch from cookie\n        const token = WebViewUtils.getUserToken();\n        if (token) {\n          this._fetchProps(\n            {u: token},\n            () => {},\n            () => {\n              // It's possible token is stored but is no longer valid\n              this.setState({\n                showTokenInput: true,\n              });\n            },\n          );\n        } else {\n          this.setState({\n            showTokenInput: true,\n          });\n        }\n\n        return;\n      }\n\n      WebViewUtils.getUserID((userFBID: string) => {\n        this._fetchProps({fbid: userFBID});\n      });\n    });\n  }\n\n  render(): React.Element<any> {\n    if (!this.getIsInitialize()) {\n      return this._renderUninitializedView();\n    }\n\n    const Component = this.props.Component;\n    return (\n      <Component\n        userID={this.state.userID}\n        {...this.state.componentProps}\n      />\n    );\n  }\n\n  _renderUninitializedView(): React.Element<*> {\n    let content = this.state.showTokenInput\n      ? <div>\n          {this._renderErrorAlert()}\n          <h5><label>{this.props.text.notSupportedText}</label></h5>\n          {this._renderTokenInput()}\n        </div>\n      : <OverlaySpinner />;\n\n    let footer = this.state.showTokenInput\n      ? this._renderFooter()\n      : null;\n\n    return (\n      <div>\n        {this.state.loading ? <OverlaySpinner /> : null}\n        <div className=\"container\">\n          <div className=\"row\">\n            <div className=\"col-xs-12 col-sm-10 col-sm-offset-1 col-md-6 col-md-offset-3\">\n              {content}\n            </div>\n          </div>\n        </div>\n        {footer}\n      </div>\n    );\n  }\n\n  _renderErrorAlert(): ?React.Element<*> {\n    if (!this.state.error) {\n      return null;\n    }\n    return (\n      <div className=\"alertHeader alert alert-danger\" role=\"alert\">\n        {this.state.error}\n      </div>\n    );\n  }\n\n  _renderTokenInput(): React.Element<*> {\n    return (\n      <div className=\"form-group\">\n        <input\n          className=\"form-control\"\n          class=\"form-control\"\n          placeholder=\"<token>\"\n          value={this.state.token}\n          onChange={(event: Object) => this.setState({token: event.target.value})}\n        />\n      </div>\n    );\n  }\n\n  _renderFooter(): React.Element<*> {\n    return (\n      <Footer\n        text={this.props.text.enterButton}\n        onClick={this._submit}\n      />\n    );\n  }\n\n  _fetchProps(req: Object, success?: Function, fail?: Function): void {\n    $.get(this.props.jsonURL, req)\n      .done((res: Object) => {\n        const {userID, ...restProps} = res;\n        this.setState({\n          userID,\n          componentProps: restProps,\n        });\n\n        success && success();\n      })\n      .fail((res: Object) => {\n        this.setState({\n          error: res.responseText,\n        });\n        fail && fail();\n      });\n  }\n\n  // submit the bot token and store in cookie\n  _submit = (): void => {\n    this._fetchProps({u: this.state.token}, () => {\n      WebViewUtils.storeUserToken(this.state.token);\n    });\n  }\n}\n\nmodule.exports = {\n  setup: (Component: Object) => {\n    global.setup = function(rootID: string, props: Object, getPropsURL: string) {\n      ReactDOM.render(\n        <UserLoaderContainer\n          {...props}\n          Component={Component}\n          jsonURL={getPropsURL}\n        />,\n        document.getElementById(rootID),\n      );\n    }\n  },\n};\n\n\n\n/** WEBPACK FOOTER **\n ** public/src/js/common/UserLoaderContainer.jsx\n **/","/*\n * @flow\n */\n\n'use strict';\n\nimport React, {PropTypes} from 'react';\nimport FooterWrapper from './FooterWrapper.jsx';\n\nclass Footer extends React.PureComponent {\n  props: {\n    text: string,\n    onClick: () => void,\n    disabled?: boolean,\n  };\n\n  render(): React.Element<*> {\n    return (\n      <FooterWrapper>\n        <div className=\"col-xs-12 col-sm-10 col-sm-offset-1 col-md-6 col-md-offset-3\">\n          <button\n            type=\"button\"\n            className=\"btn btn-primary btn-lg btn-block\"\n            disabled={this.props.disabled}\n            onClick={this.props.onClick}>\n            {this.props.text}\n          </button>\n        </div>\n      </FooterWrapper>\n    );\n  }\n}\n\nmodule.exports = Footer;\n\n\n\n/** WEBPACK FOOTER **\n ** public/src/js/common/Footer.jsx\n **/","/*\n * @flow\n */\n\n'use strict';\n\nimport React, {PropTypes} from 'react';\n\nclass FooterWrapper extends React.PureComponent {\n  render(): React.Element<*> {\n    return (\n      <div className=\"footer\">\n        <div className=\"container\">\n          <div className=\"row\">\n            {this.props.children}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nmodule.exports = FooterWrapper;\n\n\n\n/** WEBPACK FOOTER **\n ** public/src/js/common/FooterWrapper.jsx\n **/","/*\n * @flow\n */\n\n'use strict';\n\nlet MessengerExtensions = null;\n\n// FB Messenger plugin is loaded asynchornously. We would use a polling approach\n// to make sure the extension is loaded.\nwindow.extAsyncInit = function() {\n  MessengerExtensions = require('MessengerExtensions');\n};\n\n// check if MessengerExtension is initialized\nfunction getExtension(success: (val: Object) => void): void {\n  console.log(MessengerExtensions);\n  if (MessengerExtensions) {\n    success(MessengerExtensions);\n    return;\n  }\n  setTimeout(getExtension, 150, success);\n}\n\nfunction isInExtention(success: (val: bool) => void): void {\n  getExtension((MessengerExtensions: Object): void => {\n    success(MessengerExtensions.isInExtension());\n  });\n}\n\nfunction getUserID(success: (userFBID: string) => void): void {\n  getExtension((MessengerExtensions: Object): void => {;\n    MessengerExtensions.getSupportedFeatures(\n      (result: Object) => {\n        console.log(result);\n      },\n      (err: Object) => {\n        console.log(err);\n      }\n    );\n\n    MessengerExtensions.getUserID((uids: Object): void => {\n      success(uids.psid);\n    }, function error(err, errorMessage) {\n      // doesn't work on desktop so use context\n      MessengerExtensions.getContext(\n        '1833481820212349', // app_id\n        (result: Object) => {\n          console.log(result.psid);\n          success(result.psid);\n        },\n        (err: Object) => {\n          console.log(err);\n        }\n      );\n\n    });\n  });\n}\n\nfunction closeWebView(): void {\n  const MessengerExtensions = require('MessengerExtensions');\n  const isSupported = MessengerExtensions.isInExtension();\n\n  if (isSupported) {\n    MessengerExtensions.requestCloseBrowser(function success() {}, function error(err) {});\n  } else {\n    window.close();\n  }\n}\n\nfunction storeUserToken(id: string): void {\n  _setCookie('u', id, 28);\n}\n\nfunction getUserToken(): string {\n  return getCookie('u');\n}\n\nfunction _setCookie(cname, cvalue, exdays) {\n  var d = new Date();\n  d.setTime(d.getTime() + (exdays*24*60*60*1000));\n  var expires = \"expires=\"+ d.toUTCString();\n  document.cookie = cname + \"=\" + cvalue + \";\" + expires + \";path=/\";\n}\n\nfunction getCookie(cname) {\n  var name = cname + \"=\";\n  var decodedCookie = decodeURIComponent(document.cookie);\n  var ca = decodedCookie.split(';');\n  for(var i = 0; i <ca.length; i++) {\n      var c = ca[i];\n      while (c.charAt(0) == ' ') {\n          c = c.substring(1);\n      }\n      if (c.indexOf(name) == 0) {\n          return c.substring(name.length, c.length);\n      }\n  }\n  return \"\";\n}\n\nmodule.exports = {\n  closeWebView,\n  getUserID,\n  isInExtention,\n  storeUserToken,\n  getUserToken,\n};\n\n\n\n/** WEBPACK FOOTER **\n ** public/src/js/common/WebViewUtils.js\n **/","module.exports = MessengerExtensions;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"MessengerExtensions\"\n ** module id = 13\n ** module chunks = 0\n **/"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AClCA;AACA;;;;;AACA;AACA;;;AAAA;AACA;;;AAAA;AACA;;;AAAA;AACA;;;AAAA;AACA;;;AAAA;AACA;;;AAAA;AACA;;;;;;;;;;;AAkBA;;;AAQA;AAAA;AACA;AADA;AACA;AADA;AACA;AADA;AAsHA;AACA;AADA;AAGA;AACA;AA1HA;AA4HA;AACA;AAEA;AAAA;AACA;AAAA;AAEA;AACA;AAnIA;AAqIA;AAIA;AACA;AACA;AACA;AA1IA;AACA;AACA;AACA;AAFA;AAHA;AAQA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AAAA;AACA;AACA;;;AAEA;AACA;AACA;AACA;;;AAEA;AACA;AAMA;AACA;;AAEA;AAEA;AAEA;AAGA;AACA;AACA;;;AAEA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAKA;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAEA;AADA;AAGA;AAJA;AAMA;AAPA;AAUA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAJA;AAOA;;;AAEA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAJA;AADA;AAVA;AADA;AAsBA;;;AA0BA;AACA;AACA;;;;AAvJA;AACA;AAyJA;;;;;;ACzLA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC3CA;AACA;;;AAAA;AACA;;;;;;;;;;;AACA;AACA;AACA;AACA;;;AAOA;AAKA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AASA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;AAEA;;AAEA;AACA;AACA;AAFA;AAIA;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;AAEA;AAAA;AACA;;AACA;AACA;AACA;AACA;AAHA;AAMA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;AAEA;AACA;AACA;AACA;;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;;;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACjIA;AACA;;;;;;;;;;;AACA;AACA;AACA;;;;;;;;;;;AACA;AACA;AACA;;;AAEA;AACA;AACA;;;AAEA;AACA;AACA;;;;AAXA;AACA;AAaA;;;;;;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACrSA;AACA;;;AACA;AACA;;;;;;;;;;;AACA;;;;;;;;;;;AACA;AACA;AACA;AAAA;AACA;AADA;AAIA;;;;AAPA;AACA;AASA;;;;;;;;ACdA;AACA;;;;;AACA;AACA;;;AAAA;AACA;;;AAAA;AACA;;;AAAA;AACA;;;AAAA;AACA;;;AAAA;AACA;;;AAAA;AACA;;;;;;;;;;;;;AAiBA;;;AAIA;AAAA;AACA;AADA;AACA;AADA;AAqJA;AACA;AACA;AACA;AACA;AAzJA;AACA;AADA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAHA;AAWA;AACA;;;AACA;AACA;AACA;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAKA;AACA;AADA;AAGA;AAEA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AADA;AAKA;;;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAHA;AACA;AAMA;AACA;AAGA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AADA;AADA;AAOA;AATA;AAYA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AAIA;;;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AALA;AADA;AAUA;;;AAEA;AACA;AAEA;AACA;AAFA;AAKA;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAFA;AACA;AAIA;AACA;AAEA;AACA;AADA;AAGA;AACA;AACA;AACA;;;;;;AAtJA;AACA;AA8JA;AACA;AACA;AACA;AAGA;AACA;AAHA;AAOA;AACA;AAZA;;;;;;;;;ACzLA;AACA;;;AACA;AACA;;;AAAA;AACA;;;;;;;;;;;AACA;;;;;;;;;;;AAOA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AALA;AADA;AADA;AAYA;;;;AArBA;AACA;AAuBA;;;;;;;;AC7BA;AACA;;;AACA;AACA;;;;;;;;;;;AACA;;;;;;;;;;;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AADA;AADA;AAQA;;;;AAXA;AACA;AAaA;;;;;;;;AClBA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;;;;;;ACtGA;;;","sourceRoot":""}